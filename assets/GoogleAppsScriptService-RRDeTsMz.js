class h{constructor(e={}){this.scriptUrl=e.scriptUrl,this.initialized=!1}async initialize(){if(!this.scriptUrl)throw new Error("scriptUrl √© obrigat√≥rio");return this.initialized=!0,!0}eventToObject(e){return{id:e.id,title:e.title||"",description:e.description||"",date:e.date,startTime:e.startTime||"",endTime:e.endTime||"",color:e.color||"#3b82f6",createdAt:e.createdAt,updatedAt:e.updatedAt}}async saveEvent(e){this.initialized||await this.initialize();try{console.log("üíæ GoogleAppsScriptService.saveEvent - Evento recebido:",{id:e.id,title:e.title,date:e.date,startTime:e.startTime,endTime:e.endTime});const t=this.eventToObject(e);return console.log("üì§ Enviando para Google Apps Script (CREATE):",t),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",data:t})}),console.log("‚úÖ Evento enviado para Google Apps Script (action: create)"),e}catch(t){const i=t.message||String(t);if(i.includes("Failed to fetch")||i.includes("NetworkError")||i.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que o evento foi salvo com sucesso"),e;throw console.error("Erro ao salvar evento via Apps Script:",t),t}}async updateEvent(e){this.initialized||await this.initialize();try{console.log("üîÑ GoogleAppsScriptService.updateEvent - Evento recebido:",{id:e.id,title:e.title,date:e.date,startTime:e.startTime,endTime:e.endTime});const t=this.eventToObject(e);return console.log("üì§ Enviando para Google Apps Script:",{action:"update",data:t}),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update",data:t})}),console.log("‚úÖ Evento atualizado via Google Apps Script (action: update)"),e}catch(t){const i=t.message||String(t);if(i.includes("Failed to fetch")||i.includes("NetworkError")||i.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que o evento foi atualizado com sucesso"),e;throw console.error("Erro ao atualizar evento via Apps Script:",t),t}}async deleteEvent(e){this.initialized||await this.initialize();try{const t=await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete",id:e})});return console.log("‚úÖ Evento exclu√≠do via Google Apps Script"),{id:e}}catch(t){const i=t.message||String(t);if(i.includes("Failed to fetch")||i.includes("NetworkError")||i.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que o evento foi exclu√≠do com sucesso"),{id:e};throw console.error("Erro ao excluir evento via Apps Script:",t),t}}async loadEvents(){this.initialized||await this.initialize();try{const e=new URL(this.scriptUrl);e.searchParams.append("action","read");const t=await fetch(e.toString(),{method:"GET",mode:"cors"});if(t.ok){const i=await t.json();if(i.success&&i.events){const d=i.events.map(s=>{if(s.date)if(s.date.includes("T")||s.date.includes("Z")){const o=new Date(s.date),a=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0");s.date=`${a}-${r}-${n}`}else if(s.date.match(/^\d{4}-\d{2}-\d{2}$/))s.date=s.date;else{const o=new Date(s.date);if(!isNaN(o.getTime())){const a=o.getFullYear(),r=String(o.getMonth()+1).padStart(2,"0"),n=String(o.getDate()).padStart(2,"0");s.date=`${a}-${r}-${n}`}}if(s.startTime){const o=String(s.startTime).trim(),a=o.match(/(\d{1,2}):(\d{2})(?::\d{2})?/);if(a){const r=a[1].padStart(2,"0"),n=a[2];s.startTime=`${r}:${n}`}else s.startTime=o}if(s.endTime){const o=String(s.endTime).trim(),a=o.match(/(\d{1,2}):(\d{2})(?::\d{2})?/);if(a){const r=a[1].padStart(2,"0"),n=a[2];s.endTime=`${r}:${n}`}else s.endTime=o}return s});return console.log(`‚úÖ ${d.length} evento(s) carregado(s) do Google Sheets`),d}else return console.warn("Resposta do Apps Script:",i),[]}else return console.warn("Erro ao carregar eventos:",t.status,t.statusText),[]}catch(e){return console.error("Erro ao carregar eventos via Apps Script:",e),[]}}async saveAction(e){this.initialized||await this.initialize();try{console.log("üíæ GoogleAppsScriptService.saveAction - A√ß√£o recebida:",e);const t={id:e.id||"",title:e.title||"",description:e.description||"",createdAt:e.createdAt||new Date().toISOString(),createdDate:e.createdDate||new Date().toISOString().split("T")[0],createdTime:e.createdTime||"",finishedDate:e.finishedDate||"",finishedTime:e.finishedTime||""};return console.log("üì§ Enviando para Google Apps Script (action: saveAction):",t),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"saveAction",data:t})}),console.log("‚úÖ A√ß√£o enviada para Google Apps Script (action: saveAction)"),t}catch(t){const i=t.message||String(t);if(i.includes("Failed to fetch")||i.includes("NetworkError")||i.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que a a√ß√£o foi salva com sucesso"),e;throw console.error("Erro ao salvar a√ß√£o via Apps Script:",t),t}}async saveNote(e){this.initialized||await this.initialize();try{console.log("üíæ GoogleAppsScriptService.saveNote - Nota recebida:",{id:e.id,title:e.title});const t={id:e.id||"",title:e.title||"",content:e.content||""};return await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"saveNote",data:t})}),console.log("‚úÖ Nota enviada para a planilha (aba Notas)"),t}catch(t){const i=t.message||String(t);if(i.includes("Failed to fetch")||i.includes("NetworkError")||i.includes("CORS"))return console.log("‚ö†Ô∏è Requisi√ß√£o enviada (no-cors). Assumindo que a nota foi registrada."),e;throw console.error("Erro ao salvar nota na planilha:",t),t}}async updateNote(e){this.initialized||await this.initialize();try{console.log("üíæ GoogleAppsScriptService.updateNote - Nota recebida:",{id:e.id,title:e.title});const t={id:e.id||"",title:e.title||"",content:e.content||""};return await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"updateNote",data:t})}),console.log("‚úÖ Nota atualizada na planilha (aba Notas)"),t}catch(t){const i=t.message||String(t);if(i.includes("Failed to fetch")||i.includes("NetworkError")||i.includes("CORS"))return console.log("‚ö†Ô∏è Requisi√ß√£o enviada (no-cors). Assumindo que a nota foi atualizada."),e;throw console.error("Erro ao atualizar nota na planilha:",t),t}}async deleteNote(e){this.initialized||await this.initialize();try{return console.log("üóëÔ∏è GoogleAppsScriptService.deleteNote - Removendo nota:",e),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deleteNote",id:e})}),console.log("‚úÖ Nota removida da planilha (aba Notas)"),{id:e}}catch(t){const i=t.message||String(t);if(i.includes("Failed to fetch")||i.includes("NetworkError")||i.includes("CORS"))return console.log("‚ö†Ô∏è Requisi√ß√£o enviada (no-cors). Assumindo que a nota foi removida."),{id:e};throw console.error("Erro ao remover nota da planilha:",t),t}}async loadNotes(){this.initialized||await this.initialize();try{const e=new URL(this.scriptUrl);e.searchParams.append("action","readNotes");const t=await fetch(e.toString(),{method:"GET",mode:"cors"});if(t.ok){const i=await t.json();if(i.success&&i.notes)return console.log(`‚úÖ ${i.notes.length} nota(s) carregada(s) da planilha`),i.notes}return console.warn("‚ö†Ô∏è N√£o foi poss√≠vel carregar notas da planilha"),[]}catch(e){return console.error("Erro ao carregar notas da planilha:",e),[]}}async updateAction(e){this.initialized||await this.initialize();try{return console.log("üîÑ GoogleAppsScriptService.updateAction - A√ß√£o recebida:",e),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"updateAction",data:e})}),console.log("‚úÖ A√ß√£o atualizada no Google Apps Script (action: updateAction)"),e}catch(t){const i=t.message||String(t);if(i.includes("Failed to fetch")||i.includes("NetworkError")||i.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que a a√ß√£o foi atualizada com sucesso"),e;throw console.error("Erro ao atualizar a√ß√£o via Apps Script:",t),t}}async getActionByEventId(e){this.initialized||await this.initialize();try{const t=new URL(this.scriptUrl);t.searchParams.append("action","getAction"),t.searchParams.append("eventId",e);const i=await fetch(t.toString(),{method:"GET",mode:"cors"});if(i.ok){const d=await i.json();if(d.success&&d.action)return d.action}return null}catch(t){return console.error("Erro ao buscar a√ß√£o:",t),null}}async getActions(e={}){this.initialized||await this.initialize();try{const t=new URL(this.scriptUrl);t.searchParams.append("action","getActions"),e.startDate&&t.searchParams.append("startDate",e.startDate),e.endDate&&t.searchParams.append("endDate",e.endDate);const i=await fetch(t.toString(),{method:"GET",mode:"cors"});if(i.ok){const d=await i.json();if(d.success&&Array.isArray(d.actions)){const s=d.actions.map(o=>{if(o.createdDate)if(o.createdDate.includes("T")||o.createdDate.includes("Z")){const a=new Date(o.createdDate),r=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0");o.createdDate=`${r}-${n}-${c}`}else if(o.createdDate.match(/^\d{4}-\d{2}-\d{2}$/))o.createdDate=o.createdDate;else{const a=o.createdDate.replace(/[\/\.]/g,"-");if(a.match(/^\d{4}-\d{2}-\d{2}$/))o.createdDate=a;else{const r=new Date(o.createdDate);if(!isNaN(r.getTime())){const n=r.getFullYear(),c=String(r.getMonth()+1).padStart(2,"0"),l=String(r.getDate()).padStart(2,"0");o.createdDate=`${n}-${c}-${l}`}}}if(o.finishedDate)if(o.finishedDate.includes("T")||o.finishedDate.includes("Z")){const a=new Date(o.finishedDate),r=a.getFullYear(),n=String(a.getMonth()+1).padStart(2,"0"),c=String(a.getDate()).padStart(2,"0");o.finishedDate=`${r}-${n}-${c}`}else if(o.finishedDate.match(/^\d{4}-\d{2}-\d{2}$/))o.finishedDate=o.finishedDate;else{const a=o.finishedDate.replace(/[\/\.]/g,"-");if(a.match(/^\d{4}-\d{2}-\d{2}$/))o.finishedDate=a;else{const r=new Date(o.finishedDate);if(!isNaN(r.getTime())){const n=r.getFullYear(),c=String(r.getMonth()+1).padStart(2,"0"),l=String(r.getDate()).padStart(2,"0");o.finishedDate=`${n}-${c}-${l}`}}}if(o.createdTime){const a=String(o.createdTime).trim(),r=a.match(/(\d{1,2}):(\d{2})(?::\d{2})?/);if(r){const n=r[1].padStart(2,"0"),c=r[2];o.createdTime=`${n}:${c}`}else o.createdTime=a}if(o.finishedTime){const a=String(o.finishedTime).trim(),r=a.match(/(\d{1,2}):(\d{2})(?::\d{2})?/);if(r){const n=r[1].padStart(2,"0"),c=r[2];o.finishedTime=`${n}:${c}`}else o.finishedTime=a}return o});return console.log(`‚úÖ ${s.length} a√ß√µes encontradas e normalizadas`),s}else return console.log("‚ÑπÔ∏è Nenhuma a√ß√£o encontrada"),[]}else return console.warn("Erro ao buscar a√ß√µes:",i.status,i.statusText),[]}catch(t){return console.error("Erro ao buscar a√ß√µes via Apps Script:",t),[]}}}export{h as G};
