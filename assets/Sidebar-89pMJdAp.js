class b{constructor(e={}){this.scriptUrl=e.scriptUrl,this.initialized=!1}async initialize(){if(!this.scriptUrl)throw new Error("scriptUrl √© obrigat√≥rio");return this.initialized=!0,!0}eventToObject(e){return{id:e.id,title:e.title||"",description:e.description||"",date:e.date,startTime:e.startTime||"",endTime:e.endTime||"",color:e.color||"#3b82f6",createdAt:e.createdAt,updatedAt:e.updatedAt}}async saveEvent(e){this.initialized||await this.initialize();try{console.log("üíæ GoogleAppsScriptService.saveEvent - Evento recebido:",{id:e.id,title:e.title,date:e.date,startTime:e.startTime,endTime:e.endTime});const t=this.eventToObject(e);return console.log("üì§ Enviando para Google Apps Script (CREATE):",t),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"create",data:t})}),console.log("‚úÖ Evento enviado para Google Apps Script (action: create)"),e}catch(t){const a=t.message||String(t);if(a.includes("Failed to fetch")||a.includes("NetworkError")||a.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que o evento foi salvo com sucesso"),e;throw console.error("Erro ao salvar evento via Apps Script:",t),t}}async updateEvent(e){this.initialized||await this.initialize();try{console.log("üîÑ GoogleAppsScriptService.updateEvent - Evento recebido:",{id:e.id,title:e.title,date:e.date,startTime:e.startTime,endTime:e.endTime});const t=this.eventToObject(e);return console.log("üì§ Enviando para Google Apps Script:",{action:"update",data:t}),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"update",data:t})}),console.log("‚úÖ Evento atualizado via Google Apps Script (action: update)"),e}catch(t){const a=t.message||String(t);if(a.includes("Failed to fetch")||a.includes("NetworkError")||a.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que o evento foi atualizado com sucesso"),e;throw console.error("Erro ao atualizar evento via Apps Script:",t),t}}async deleteEvent(e){this.initialized||await this.initialize();try{const t=await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"delete",id:e})});return console.log("‚úÖ Evento exclu√≠do via Google Apps Script"),{id:e}}catch(t){const a=t.message||String(t);if(a.includes("Failed to fetch")||a.includes("NetworkError")||a.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que o evento foi exclu√≠do com sucesso"),{id:e};throw console.error("Erro ao excluir evento via Apps Script:",t),t}}async loadEvents(){this.initialized||await this.initialize();try{const e=new URL(this.scriptUrl);e.searchParams.append("action","read");const t=await fetch(e.toString(),{method:"GET",mode:"cors"});if(t.ok){const a=await t.json();if(a.success&&a.events){const d=a.events.map(n=>{if(n.date)if(n.date.includes("T")||n.date.includes("Z")){const s=new Date(n.date),o=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0");n.date=`${o}-${i}-${c}`}else if(n.date.match(/^\d{4}-\d{2}-\d{2}$/))n.date=n.date;else{const s=new Date(n.date);if(!isNaN(s.getTime())){const o=s.getFullYear(),i=String(s.getMonth()+1).padStart(2,"0"),c=String(s.getDate()).padStart(2,"0");n.date=`${o}-${i}-${c}`}}if(n.startTime){const s=String(n.startTime).trim(),o=s.match(/(\d{1,2}):(\d{2})(?::\d{2})?/);if(o){const i=o[1].padStart(2,"0"),c=o[2];n.startTime=`${i}:${c}`}else n.startTime=s}if(n.endTime){const s=String(n.endTime).trim(),o=s.match(/(\d{1,2}):(\d{2})(?::\d{2})?/);if(o){const i=o[1].padStart(2,"0"),c=o[2];n.endTime=`${i}:${c}`}else n.endTime=s}return n});return console.log(`‚úÖ ${d.length} evento(s) carregado(s) do Google Sheets`),d}else return console.warn("Resposta do Apps Script:",a),[]}else return console.warn("Erro ao carregar eventos:",t.status,t.statusText),[]}catch(e){return console.error("Erro ao carregar eventos via Apps Script:",e),[]}}async saveAction(e){this.initialized||await this.initialize();try{console.log("üíæ GoogleAppsScriptService.saveAction - A√ß√£o recebida:",e);const t={id:e.id||"",title:e.title||"",description:e.description||"",createdAt:e.createdAt||new Date().toISOString(),createdDate:e.createdDate||new Date().toISOString().split("T")[0],createdTime:e.createdTime||"",finishedDate:e.finishedDate||"",finishedTime:e.finishedTime||""};return console.log("üì§ Enviando para Google Apps Script (action: saveAction):",t),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"saveAction",data:t})}),console.log("‚úÖ A√ß√£o enviada para Google Apps Script (action: saveAction)"),t}catch(t){const a=t.message||String(t);if(a.includes("Failed to fetch")||a.includes("NetworkError")||a.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que a a√ß√£o foi salva com sucesso"),e;throw console.error("Erro ao salvar a√ß√£o via Apps Script:",t),t}}async updateAction(e){this.initialized||await this.initialize();try{return console.log("üîÑ GoogleAppsScriptService.updateAction - A√ß√£o recebida:",e),await fetch(this.scriptUrl,{method:"POST",mode:"no-cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"updateAction",data:e})}),console.log("‚úÖ A√ß√£o atualizada no Google Apps Script (action: updateAction)"),e}catch(t){const a=t.message||String(t);if(a.includes("Failed to fetch")||a.includes("NetworkError")||a.includes("CORS"))return console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar resposta (no-cors), mas a requisi√ß√£o foi enviada"),console.log("‚úÖ Assumindo que a a√ß√£o foi atualizada com sucesso"),e;throw console.error("Erro ao atualizar a√ß√£o via Apps Script:",t),t}}async getActionByEventId(e){this.initialized||await this.initialize();try{const t=new URL(this.scriptUrl);t.searchParams.append("action","getAction"),t.searchParams.append("eventId",e);const a=await fetch(t.toString(),{method:"GET",mode:"cors"});if(a.ok){const d=await a.json();if(d.success&&d.action)return d.action}return null}catch(t){return console.error("Erro ao buscar a√ß√£o:",t),null}}async getActions(e={}){this.initialized||await this.initialize();try{const t=new URL(this.scriptUrl);t.searchParams.append("action","getActions"),e.startDate&&t.searchParams.append("startDate",e.startDate),e.endDate&&t.searchParams.append("endDate",e.endDate);const a=await fetch(t.toString(),{method:"GET",mode:"cors"});if(a.ok){const d=await a.json();if(d.success&&Array.isArray(d.actions)){const n=d.actions.map(s=>{if(s.createdDate)if(s.createdDate.includes("T")||s.createdDate.includes("Z")){const o=new Date(s.createdDate),i=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),l=String(o.getDate()).padStart(2,"0");s.createdDate=`${i}-${c}-${l}`}else if(s.createdDate.match(/^\d{4}-\d{2}-\d{2}$/))s.createdDate=s.createdDate;else{const o=s.createdDate.replace(/[\/\.]/g,"-");if(o.match(/^\d{4}-\d{2}-\d{2}$/))s.createdDate=o;else{const i=new Date(s.createdDate);if(!isNaN(i.getTime())){const c=i.getFullYear(),l=String(i.getMonth()+1).padStart(2,"0"),m=String(i.getDate()).padStart(2,"0");s.createdDate=`${c}-${l}-${m}`}}}if(s.finishedDate)if(s.finishedDate.includes("T")||s.finishedDate.includes("Z")){const o=new Date(s.finishedDate),i=o.getFullYear(),c=String(o.getMonth()+1).padStart(2,"0"),l=String(o.getDate()).padStart(2,"0");s.finishedDate=`${i}-${c}-${l}`}else if(s.finishedDate.match(/^\d{4}-\d{2}-\d{2}$/))s.finishedDate=s.finishedDate;else{const o=s.finishedDate.replace(/[\/\.]/g,"-");if(o.match(/^\d{4}-\d{2}-\d{2}$/))s.finishedDate=o;else{const i=new Date(s.finishedDate);if(!isNaN(i.getTime())){const c=i.getFullYear(),l=String(i.getMonth()+1).padStart(2,"0"),m=String(i.getDate()).padStart(2,"0");s.finishedDate=`${c}-${l}-${m}`}}}if(s.createdTime){const o=String(s.createdTime).trim(),i=o.match(/(\d{1,2}):(\d{2})(?::\d{2})?/);if(i){const c=i[1].padStart(2,"0"),l=i[2];s.createdTime=`${c}:${l}`}else s.createdTime=o}if(s.finishedTime){const o=String(s.finishedTime).trim(),i=o.match(/(\d{1,2}):(\d{2})(?::\d{2})?/);if(i){const c=i[1].padStart(2,"0"),l=i[2];s.finishedTime=`${c}:${l}`}else s.finishedTime=o}return s});return console.log(`‚úÖ ${n.length} a√ß√µes encontradas e normalizadas`),n}else return console.log("‚ÑπÔ∏è Nenhuma a√ß√£o encontrada"),[]}else return console.warn("Erro ao buscar a√ß√µes:",a.status,a.statusText),[]}catch(t){return console.error("Erro ao buscar a√ß√µes via Apps Script:",t),[]}}}class E{constructor(e={}){this.storageKey=e.storageKey||"calendar-events"}async initialize(){return!0}async saveEvent(e){try{const t=this.loadEventsFromStorage();return t.push(e),this.saveEventsToStorage(t),console.log("‚úÖ Evento salvo no armazenamento local"),e}catch(t){throw console.error("Erro ao salvar evento:",t),t}}async updateEvent(e){try{const t=this.loadEventsFromStorage(),a=t.findIndex(d=>d.id===e.id);if(a===-1)throw new Error("Evento n√£o encontrado");return t[a]=e,this.saveEventsToStorage(t),console.log("‚úÖ Evento atualizado no armazenamento local"),e}catch(t){throw console.error("Erro ao atualizar evento:",t),t}}async deleteEvent(e){try{const a=this.loadEventsFromStorage().filter(d=>d.id!==e);return this.saveEventsToStorage(a),console.log("‚úÖ Evento exclu√≠do do armazenamento local"),{id:e}}catch(t){throw console.error("Erro ao excluir evento:",t),t}}async loadEvents(){try{return this.loadEventsFromStorage()}catch(e){return console.error("Erro ao carregar eventos:",e),[]}}loadEventsFromStorage(){try{const e=localStorage.getItem(this.storageKey);return e?JSON.parse(e):[]}catch(e){return console.error("Erro ao ler do localStorage:",e),[]}}saveEventsToStorage(e){try{localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(t){throw console.error("Erro ao salvar no localStorage:",t),t}}clear(){localStorage.removeItem(this.storageKey)}}const f="/ambiente-dev/";class T{constructor(e="Usu√°rio",t="home"){this.username=e,this.currentPage=t}render(){return`
      <!-- Overlay para mobile -->
      <div id="sidebar-overlay" class="sidebar-overlay hidden"></div>

      <!-- Sidebar Menu -->
      <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
          <div class="flex items-center justify-between mb-6">
            <div class="sidebar-header-content">
              <h2 class="text-xl font-bold text-white">Ambiente Dev</h2>
              <p class="text-sm text-gray-400 sidebar-username">${this.username}</p>
            </div>
            <div class="flex items-center gap-2">
              <button id="sidebar-toggle-desktop" class="sidebar-close-btn hidden lg:flex" title="Fechar menu">
                <i class="fas fa-chevron-left"></i>
              </button>
              <button id="sidebar-close" class="sidebar-close-btn lg:hidden">
                <i class="fas fa-times"></i>
              </button>
            </div>
          </div>
        </div>
        
        <nav class="sidebar-nav">
          <a href="${f}home.html" class="sidebar-item ${this.currentPage==="home"?"active":""}" data-page="home">
            <i class="fas fa-home"></i>
            <span class="sidebar-item-text">Home</span>
          </a>
          <a href="${f}agenda.html" class="sidebar-item ${this.currentPage==="agenda"?"active":""}" data-page="agenda">
            <i class="fas fa-calendar"></i>
            <span class="sidebar-item-text">Agenda</span>
          </a>
          <a href="${f}dashboard.html" class="sidebar-item ${this.currentPage==="dashboard"?"active":""}" data-page="dashboard">
            <i class="fas fa-chart-bar"></i>
            <span class="sidebar-item-text">Dashboard</span>
          </a>
        </nav>

        <div class="sidebar-footer">
          <button id="logout-btn" class="sidebar-item sidebar-item-logout">
            <i class="fas fa-sign-out-alt"></i>
            <span class="sidebar-item-text">Sair</span>
          </button>
        </div>
      </aside>
      </aside>
    `}renderTopBar(e,t=""){return`
      <header class="top-bar">
        <button id="sidebar-toggle" class="menu-toggle-btn lg:hidden">
          <i class="fas fa-bars"></i>
        </button>
        <button id="sidebar-toggle-desktop-top" class="menu-toggle-btn hidden lg:flex" title="Abrir menu">
          <i class="fas fa-bars"></i>
        </button>
        <div>
          <h1 class="text-xl md:text-2xl font-bold text-white">${e}</h1>
          ${t?`<p class="text-sm text-gray-400">${t}</p>`:""}
        </div>
      </header>
    `}init(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-toggle"),a=document.getElementById("sidebar-close"),d=document.getElementById("sidebar-overlay"),n=document.getElementById("logout-btn"),s=()=>{const r=document.querySelector(".main-content");r&&(window.innerWidth>=1024?e.classList.contains("collapsed")?(r.style.marginLeft="0",r.style.width="100%"):(e.classList.contains("desktop-open")||e.classList.contains("open"))&&(r.style.marginLeft="280px",r.style.width="calc(100% - 280px)"):(r.style.marginLeft="0",r.style.width="100%"))},o=()=>{e.classList.add("open"),d.classList.remove("hidden"),d.classList.add("show"),document.body.style.overflow="hidden",s()},i=()=>{e.classList.remove("open"),d.classList.remove("show"),setTimeout(()=>{d.classList.add("hidden")},300),document.body.style.overflow="",s()},c=()=>{e.classList.remove("desktop-open"),e.classList.add("collapsed"),localStorage.setItem("sidebar-collapsed","true");const r=document.getElementById("sidebar-toggle-desktop-top");r&&(r.style.display="flex"),s()},l=()=>{e.classList.remove("collapsed"),e.classList.add("desktop-open"),localStorage.setItem("sidebar-collapsed","false");const r=document.getElementById("sidebar-toggle-desktop-top");r&&(r.style.display="none"),s()},m=localStorage.getItem("sidebar-collapsed")==="true";if(window.innerWidth>=1024)if(m){e.classList.add("collapsed");const r=document.getElementById("sidebar-toggle-desktop-top");r&&(r.style.display="flex")}else{e.classList.add("desktop-open");const r=document.getElementById("sidebar-toggle-desktop-top");r&&(r.style.display="none")}s(),t&&t.addEventListener("click",()=>{window.innerWidth<1024&&o()});const p=document.getElementById("sidebar-toggle-desktop-top");p&&(window.innerWidth<1024&&(p.style.display="none"),p.addEventListener("click",()=>{if(window.innerWidth>=1024&&e.classList.contains("collapsed")){l();const r=document.getElementById("sidebar-toggle-desktop");r&&(r.innerHTML='<i class="fas fa-chevron-left"></i>',r.title="Fechar menu"),p.style.display="none"}})),a&&a.addEventListener("click",i),d&&d.addEventListener("click",i);const g=document.getElementById("sidebar-toggle-desktop");g&&g.addEventListener("click",()=>{e.classList.contains("collapsed")?(l(),g.innerHTML='<i class="fas fa-chevron-left"></i>',g.title="Fechar menu",p&&(p.style.display="none")):(c(),g.innerHTML='<i class="fas fa-chevron-right"></i>',g.title="Abrir menu",p&&(p.style.display="flex"))});const S=()=>{const r=document.getElementById("sidebar-toggle-desktop-top"),u=document.getElementById("sidebar-toggle");if(window.innerWidth>=1024){d.classList.add("hidden"),d.classList.remove("show"),document.body.style.overflow="",e.classList.remove("open"),u&&(u.style.display="none");const v=localStorage.getItem("sidebar-collapsed")==="true";v?(e.classList.add("collapsed"),e.classList.remove("desktop-open")):(e.classList.remove("collapsed"),e.classList.add("desktop-open"));const h=document.getElementById("sidebar-toggle-desktop");h&&(v?(h.innerHTML='<i class="fas fa-chevron-right"></i>',h.title="Abrir menu",r&&(r.style.display="flex")):(h.innerHTML='<i class="fas fa-chevron-left"></i>',h.title="Fechar menu",r&&(r.style.display="none")))}else e.classList.remove("collapsed","desktop-open"),u&&(u.style.display="flex"),r&&(r.style.display="none");s()};window.addEventListener("resize",S),S(),document.addEventListener("keydown",r=>{r.key==="Escape"&&e&&e.classList.contains("open")&&i()}),n&&n.addEventListener("click",()=>{sessionStorage.removeItem("authenticated"),sessionStorage.removeItem("username"),window.location.href=`${f}index.html`})}}export{b as G,E as L,T as S};
